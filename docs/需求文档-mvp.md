# 考研学习助手 - MVP（第一期）需求文档

**版本**: v1.0-mvp
**创建日期**: 2025-11-17
**目标用户**: 考研学生（PC端优先）
**文档状态**: 核心功能需求

---

## 一、项目概述

### 1.1 项目背景
开发一个用于考研学习的AI助手网站，核心目标是将AI深度讲解与知识卡片管理相结合，为考研学生提供高效的学习工具。

### 1.2 核心价值
1. **深度学习**: 通过分步、交互式的AI讲解，实现"知其然，更知其所以然"
2. **知识管理**: 将学习内容转化为结构化、可检索的知识卡片
3. **效率提升**: 减少重复劳动，专注于学习本身

### 1.3 第一期目标
- **目标**: 跑通"AI对话-卡片展示-详情查看"核心闭环
- **核心功能**: AI问答、卡片创建、基础展示、卡片详情
- **平台**: PC端桌面应用（Electron）
- **用户**: 个人使用
- **数据**: SQLite本地数据库存储

---

## 二、MVP核心功能需求

### 2.1 AI问答与学习界面

#### 2.1.1 用户输入
- **支持格式**: 文字、图片（截图）
- **输入方式**:
  - 拖拽上传图片
  - 复制粘贴（截图直接粘贴）
  - 混合输入（图片+补充文字）
- **快速操作**: 左栏提供"新建卡片"按钮，支持一键创建空白卡片

#### 2.1.2 OCR处理流程
- **触发时机**: 检测到图片时自动触发
- **处理逻辑**: 调用视觉模型（如GLM-4V）进行OCR识别
- **结果展示**:
  - OCR结果作为消息的一部分展示
  - 可实时编辑和修正（第一次不确认，提升速度）
  - 编辑后支持"重新发送"
- **未来优化**: 当模型具备原生视觉能力时，跳过OCR步骤

#### 2.1.3 主问答AI解答生成
- **处理流程**: 题目信息 + 预设System Prompt → 模型
- **输出方式**: 流式传输（streaming）
- **交互特性**:
  - 流式输出直接显示在原始输出标签页
  - 提供markdown渲染，支持数学公式（LaTeX/KaTeX）
  - 支持用户配置提示词，根据学科定制输出风格

#### 2.1.4 HTML助手后处理
- **功能**: 将主AI的讲解内容转换为结构化的HTML
- **输入**: 主AI的完整输出 + 预设HTML转换Prompt → htmlAI模型
- **输出特性**:
  - 自动生成格式化的HTML内容
  - 支持公式渲染、代码高亮、步骤结构化展示
  - 提供更清晰的阅读体验
- **配置选项**:
  - 支持用户配置htmlAI的提示词
  - 支持设置"主AI输出完毕后是否自动生成html"
  - 支持设置"html生成完毕后是否自动跳转到html标签页"
- **执行时机**: 根据用户配置自动执行或手动触发
- **状态管理**: htmlAI处理过程中显示"正在生成结构化内容..."状态
- **阅读位置记忆**: 自动记录用户在原始输出的阅读位置（百分比），跳转后同步滚动到相同位置

#### 2.1.5 话题信息助手（信息AI）
- **功能**: 自动生成卡片元数据（标签、目录推荐）
- **输入**: 主AI输出内容 + 预设信息提取Prompt → 信息AI模型
- **输出内容**:
  - 知识点标签（如"二元函数求极值"）
  - 目录推荐（如"数学-真题-2017-T13"）
  - 题目描述（从主AI输出中提取，含LaTeX格式）
  - 标准解题流程（待定，需优化提示词）
  - 最终答案（待定，需优化提示词）
- **配置选项**: 支持用户配置信息AI的提示词，优化推荐质量
- **执行时机**: 主AI输出完成后触发，与htmlAI并行执行
- **状态管理**: 处理过程中显示"正在分析知识点..."状态
- **注意**: 信息AI（话题信息助手）仅用于生成卡片元数据，底部创建面板只需等待信息AI完成即可展示

#### 2.1.6 后处理任务状态管理
- **状态指示器**: AI解答完成后显示并行任务状态
  - `[▶] 正在生成结构化内容...`
  - `[▶] 正在分析知识点...`
- **完成标识**: 任务完成后显示 `[✓]`
- **错误处理**: 失败任务支持重试

#### 2.1.7 追问与上下文记忆
- **会话管理**: 保留完整对话历史
- **追问功能**: 基于当前题目和解答进行连续提问
- **上下文加载**: 切换工作区时自动恢复对话状态

### 2.2 卡片创建与管理

#### 2.2.1 创建时机
- **触发方式**: 用户主动点击"保存"按钮（信息AI完成后常驻面板自动滑入）
- **交互形式**: 非侵入式常驻面板
- **面板位置**: 右侧工作台底部或侧边
- **展示时机**: 信息AI（话题信息助手）完成后滑入（无需等待htmlAI完成）
- **手动创建**: 右栏提供"新建卡片"按钮，支持一键创建空白卡片（不依赖AI分析）

#### 2.2.2 创建面板设计
- **显示内容**:
  - AI推荐的目录（可编辑，默认选中，支持微调）
  - AI推荐的标签（可编辑，带历史使用标签联想）
  - "确认创建卡片"按钮
  - "暂不处理"按钮
- **动画效果**: 从右下角底部滑入（0.3秒）
- **交互特性**:
  - 不遮挡解答内容
  - 支持快速修改
  - 点击后显示Toast提示"卡片已创建"（从顶部滑入，2秒后消失）

#### 2.2.3 确认式创建表单
- **表单字段**:
  - 目录（支持层级结构，如"数学-真题-2017-T13"）
  - 标签（多标签，支持自动补全和历史标签联想）
  - 题目描述（信息AI自动提取，含LaTeX）
  - 答案内容（主AI输出的HTML）
- **智能推荐**:
  - AI自动推荐目录和标签（基于题目内容）
  - 目录推荐记忆：学习用户偏好，推荐上次手动选择的相似目录（非AI实现）
  - 标签推荐：仅基于当前题目，不支持历史相似标签推荐
- **操作选项**:
  - "创建并查看": 创建后切换到卡片列表，高亮新卡片并清空工作台

#### 2.2.4 卡片数据结构
- **核心字段**:
  - `id`: 唯一标识
  - `user_id`: 用户ID（从MVP期开始预埋）
  - `question`: 题目内容（信息AI提取，含LaTeX）
  - `answer_html`: AI生成的HTML解答
  - `directory`: 目录路径
  - `tags`: 标签数组（扁平化结构，支持多标签）
  - `created_at`: 创建时间
  - `updated_at`: 更新时间
  - `ai_conversation_history`: AI对话历史（用于详情页展示和追问）
  - `status`: 状态（新题/学习中/已掌握）**MVP中隐藏，不显示在UI**
  - `next_review`: 下次复习时间（预留字段，MVP中隐藏）
  - `review_count`: 复习次数（预留字段，MVP中隐藏）
  - `difficulty`: 难度评级（预留字段，MVP中隐藏）
  - `sync_status`: 同步状态（synced/pending/conflict）**用于多PC同步**
  - `device_id`: 设备ID（记录最后修改的设备）**用于冲突检测**
  - `version`: 版本号（递增，用于冲突检测）**多设备同步预留**

### 2.3 展示、回看与卡片详情

#### 2.3.1 PC端三栏式布局与页面状态

**系统采用两种核心页面状态：总览页面 和 卡片详情页面**

**总览界面（卡片浏览模式）**
- **左栏**: 导航面板
  - 顶部包含展开/折叠按钮，支持全屏展开和收起左栏
  - 可切换目录/标签两种视图
  - 支持搜索和筛选功能
  - 右键菜单支持创建文件夹（从零开始，无预设模板）
  - 层级结构: 完全自由创建，最多5层（如：学科-类型-年份-题号）
  - 底部提供"新建卡片"按钮，支持一键创建空白卡片
- **中栏**: 卡片列表
  - 展示卡片摘要：题目（OCR提取的含LaTeX文本）、标签、创建时间
  - 支持按时间/标签/目录排序
  - 支持多选操作（批量移动、删除、导出）
  - 鼠标hover时在右栏展示卡片概览信息
- **右栏**: 卡片概览面板
  - 鼠标hover中栏卡片时，显示该卡片详细信息的预览
  - 卡片概览信息包括：完整题目、所属目录、标签、标准解题流程（待定）、最终答案
  - 未hover时保持空白

**卡片详情界面（深度学习模式）**
- **界面布局重构**: 当用户点击中栏的某个卡片后，系统切换至卡片详情界面（前端路由切换，如从/cards到/card/:id）
- **右栏**: 卡片详情面板
  - 完整展示卡片的所有信息
  - 包括题目描述、完整解答、标签、目录等元数据
  - 支持编辑、导出、分享、打印等操作
  - 提供"返回总览"按钮，返回时保留总览页的筛选和排序状态
- **中栏**: AI对话与工作区域
  - 显示两个可切换的标签页：
    - **原始输出标签页**: 显示主问答AI的流式输出原文
      - 提供markdown渲染，支持数学公式（LaTeX/KaTeX）
      - 对话历史懒加载：默认显示最近3轮对话（用户提问+AI回答），向上滚动加载更多
      - 支持复制、搜索原文内容
    - **格式化输出标签页**: 显示HTML助手处理后的结构化内容
      - 接收主AI的输出内容，调用htmlAI转换为结构化HTML
      - 自动渲染公式、代码块、步骤等
      - 提供更清晰的阅读体验
  - 支持在卡片内继续追问AI，保留上下文
- **状态切换**: 详情界面支持一键返回总览界面，总览页的筛选、滚动位置不变

#### 2.3.2 筛选与搜索
- **筛选维度**:
  - 学科（数学、英语、政治等）
  - 目录路径
  - 标签
  - 创建时间
- **组合筛选**: 支持多条件组合
- **语义搜索**: 预留基于向量数据库的自然语言搜索接口（不实现）

#### 2.3.3 数据组织
- **目录结构示例**:
  - `数学-真题-2011-Text4` (T代表题，Text4表示第4题)
  - `数学-真题-2017-T13` (T13表示第13题)
  - `英语-模拟题-XX机构-Test1`
- **目录管理**:
  - 完全自由创建，从零开始，无预设模板
  - 类似Windows文件管理器，支持5层嵌套
- **标签体系（扁平化）**:
  - 无层级嵌套，支持一道题打多个标签
  - 示例：对同一道题同时创建"数学、高数、微分"三个标签，方便检索
  - 标签类型:
    - 知识点: 二元函数求极值、定积分应用、微分中值定理
    - 题型: 选择题、填空题、解答题（信息AI自动提取）
    - 难度: 基础、进阶、困难

### 2.4 设置与配置管理

#### 2.4.1 设置页面入口
- **位置**: 左栏底部设置按钮
- **访问方式**: 点击设置图标或菜单进入
- **页面布局**: 单列配置面板，分组展示配置项
- **保存机制**: 实时保存或手动保存按钮

#### 2.4.2 助手提示词配置
- **主问答AI提示词配置**:
  - 文本框输入自定义System Prompt
  - 提供默认提示词模板（数学/408通用，暂不支持英语、政治）
  - 提供重置为默认模板功能
  - 提示词效果预览功能
- **htmlAI提示词配置**:
  - 文本框输入HTML转换专用Prompt
  - 提供结构化输出模板
  - 支持markdown渲染样式自定义
  - 预览转换效果
- **信息AI提示词配置**:
  - 文本框输入信息提取专用Prompt
  - 支持标签、目录推荐规则自定义
  - 推荐结果预览

#### 2.4.3 HTML生成自动化配置
- **自动生成开关**:
  - 选项: 主AI输出完毕后是否自动生成html
  - 状态: 开启/关闭
  - 提示: 开启后将自动调用htmlAI处理
- **自动跳转开关**:
  - 选项: html生成完毕后是否自动跳转到html标签页
  - 状态: 开启/关闭
  - 高级功能:
    - 自动记录当前阅读位置
    - 跳转后恢复相同阅读位置
    - 确保阅读体验的连续性
- **手动模式**: 当自动生成关闭时，提供手动"生成HTML"按钮

#### 2.4.4 多PC同步配置
- **同步方式**:
  - 数据库文件云同步（支持坚果云、OneDrive等云盘服务）
  - 默认路径：云同步目录下的 `KaoyanApp/data.db` 文件
- **同步策略**:
  - 应用启动时使用本地缓存（<2秒快速启动）
  - 启动后后台异步同步云盘最新数据
  - 数据修改延迟3秒再写入云盘（避免频繁写入冲突）
- **同步时机**:
  - 应用启动后立即后台同步
  - 数据修改延迟写入（3秒内合并多次修改）
  - 窗口失焦时触发同步
  - 周期性检查（每30分钟）
- **用户配置选项**:
  - 自定义数据库文件存储路径
  - 切换模式：本地存储/云盘同步
  - 手动触发立即同步按钮
- **同步状态管理**:
  - 状态指示器：已同步/同步中/冲突/离线
  - 冲突检测：自动备份当前数据为 `.backup_时间戳.db`
  - 冲突处理提示：引导用户手动合并数据或从备份恢复
- **版本兼容**:
  - 自动检测并迁移数据结构
  - 保留云盘同步目录下最近7天的数据库备份文件

#### 2.4.5 其他配置项
- **界面配置**:
  - 左栏默认展开/折叠状态
  - 列表项密度（紧凑/标准/宽松）
  - 主题配色（浅色/深色/自动）
- **导入导出**:
  - 导出全部配置为JSON文件
  - 从文件导入配置
  - 恢复默认配置（二次确认）

---

## 三、交互设计

### 3.1 核心场景设计

#### 场景一: 连续刷题，批量创建卡片
1. 用户在右侧工作台上传题目，获得解答
2. 底部常驻面板滑入，显示推荐目录和标签
3. 用户确认创建，点击"✓ 确认创建卡片"
4. 界面自动重置:
   - 清空右侧AI聊天界面
   - 光标定位到输入框
   - 中栏显示Toast提示"[数学] [二元函数求极值] 卡片已创建"
5. 用户可立即处理下一题

#### 场景二: 查看卡片详情并深度追问
1. 用户在左侧目录/标签筛选卡片
2. 鼠标hover中栏卡片列表，右栏显示卡片概览
3. 点击中栏的某个卡片，进入卡片详情界面
4. 右栏显示完整的卡片详情（题目、解答、标签、元数据）
5. 中栏显示AI对话区域，默认在"原始输出"标签页
6. 用户可切换到"格式化输出"标签页查看结构化HTML
7. 阅读过程中产生疑问，直接在中栏输入追问内容
8. AI基于卡片上下文和原始对话进行回答
9. 点击"返回总览"按钮，平滑返回卡片列表界面

#### 场景三: 调整AI助手配置
1. 用户点击左栏底部的"设置"按钮
2. 进入设置页面，查看当前配置
3. 在"主问答AI提示词"配置区，修改默认的System Prompt
4. 在"htmlAI提示词"配置区，调整HTML转换规则
5. 开启"自动生成html"选项
6. 开启"自动跳转到html标签页"选项，并启用阅读位置记忆
7. 保存配置，返回主界面
8. 此时处理新题目，AI输出后自动跳转至格式化标签页
9. 切换标签页时的阅读位置被自动保留，体验连贯

#### 场景四: OCR错误修正
1. 用户发送带图片的消息
2. 聊天记录显示OCR结果气泡
3. 用户发现OCR错误
4. 点击"编辑"按钮（AI流式输出自动停止）
5. OCR文本变为可编辑输入框
6. 用户修正后点击"重新发送"
7. 流程用正确文本重新开始

---

### 3.2 用户体验原则
- **无打断**: 常驻面板替代弹窗，不干扰思考
- **上下文保持**: 同屏显示相关信息，保持阅读位置连贯性
- **即时性**: 学完立即归档
- **控制权**: 用户可随时选择"暂不处理"
- **心流状态**: 一键重置，支持连续操作
- **防重复**: 标签自动补全和历史联想
- **灵活性**: 支持高度自定义AI助手行为和界面布局
- **沉浸式**: hover预览与详情页面无缝切换，减少认知负担
